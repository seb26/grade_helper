<div id="app_input_drop_area" style="padding:2rem; background:#fcc;">
    <form id="app_input_cdl">
        <label for="app_input_cdl_filepicker">Select file(s):</label>
        <input type="file" id="app_input_cdl_filepicker" multiple>
        <input type="button" id="app_input_cdl_clear" value="Clear"> 
    </form>
</div>

<section style="padding:2rem; background: #ccf;">
    <div id="app_input_active_cdls"></div>
</section>

<script type="text/javascript" src="cdl_multi_to_single/lib.js"></script>
<script type="text/javascript">

function read_file_to_string( file, filename ) {
    let reader = new FileReader();
    reader.readAsBinaryString( file );
    reader.onloadend = function() {
        app.files_read[filename] = reader.result;
        event_update_file_list();
    }
}

function read_files_multiple(files) {
    for ( var i = 0; i < files.length; i++ ) {
        var file = files[i];
        read_file_to_string(file, file.name);
    }
}

function event_read_files_dropped(e) {
    var files = [...e.dataTransfer.files];
    console.log( 'd', files );
    read_files_multiple(files);
}

function event_read_files_selected(e) {
    var files = e.target.files;
    console.log( 's', files );
    read_files_multiple(files);
}

function event_update_file_list() {
    var display_list = [ '<ul>' ];
    const display_list_item = (name, data) =>`<li>${name}: data: ${data}</li>`;
    for ( var filename in list_of_parsed_files ) {
        display_list.push( display_list_item(filename, list_of_parsed_files[filename] ) );
    }
    app_input_active_cdls.innerHTML = display_list.join('\n');
}

// APP
const app = new App();
const color_item_set = new ColorItemSet();

// APP INTERFACE

const app_input_cdl_filepicker = document.getElementById('app_input_cdl_filepicker');
const app_input_drop_area = document.getElementById('app_input_drop_area');
const app_input_active_cdls = document.getElementById('app_input_active_cdls');

// EVENT HANDLERS
// Prevent default drag behaviors
;['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event_name => {
    app_input_drop_area.addEventListener(event_name, preventDefaults, false)   
    document.body.addEventListener(event_name, preventDefaults, false)
})

function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
}

app_input_drop_area.addEventListener('drop', event_read_files_dropped, false);
app_input_cdl_filepicker.addEventListener('change', event_read_files_selected, false);

</script>